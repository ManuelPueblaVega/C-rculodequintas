<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Círculo de Quintas Interactivo (Sin API)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Variables CSS para tamaños y dimensiones, facilitando la responsividad */
        :root {
            --circle-desktop-size: 600px;
            --outer-segment-width: 100px;
            --outer-segment-height: 50px;
            --inner-segment-width: 80px;
            --inner-segment-height: 40px;
            --circle-center-size: 100px;
        }

        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            overflow: hidden;
            padding: 1rem;
        }

        #circle-of-fifths-container {
            position: relative;
            width: var(--circle-desktop-size);
            height: var(--circle-desktop-size);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 90vw;
            max-height: 90vw;
            background-color: #ffffff;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .outer-circle, .inner-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .inner-circle {
            width: 60%;
            height: 60%;
        }

        .note-segment {
            position: absolute;
            width: var(--outer-segment-width);
            height: var(--outer-segment-height);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            background-color: #fff;
            border: 1px solid #ccc;
            transition: background-color 0.3s ease, color 0.3s ease;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: #333;
            font-size: 1.1rem;
        }

        .outer-circle .note-segment {
            transform-origin: 50% calc(var(--circle-desktop-size) / 2);
            transform: translateY(calc( -1 * (var(--circle-desktop-size) / 2) + (var(--outer-segment-height) / 2) )) rotate(var(--rotation-deg));
        }

        .inner-circle .note-segment {
            width: var(--inner-segment-width);
            height: var(--inner-segment-height);
            transform-origin: 50% calc(var(--circle-desktop-size) * 0.6 / 2);
            transform: translateY(calc( -1 * (var(--circle-desktop-size) * 0.6 / 2) + (var(--inner-segment-height) / 2) )) rotate(var(--rotation-deg));
        }

        .outer-circle .note-segment:nth-child(1), .inner-circle .note-segment:nth-child(1) { --rotation-deg: 0deg; }
        .outer-circle .note-segment:nth-child(2), .inner-circle .note-segment:nth-child(2) { --rotation-deg: 30deg; }
        .outer-circle .note-segment:nth-child(3), .inner-circle .note-segment:nth-child(3) { --rotation-deg: 60deg; }
        .outer-circle .note-segment:nth-child(4), .inner-circle .note-segment:nth-child(4) { --rotation-deg: 90deg; }
        .outer-circle .note-segment:nth-child(5), .inner-circle .note-segment:nth-child(5) { --rotation-deg: 120deg; }
        .outer-circle .note-segment:nth-child(6), .inner-circle .note-segment:nth-child(6) { --rotation-deg: 150deg; }
        .outer-circle .note-segment:nth-child(7), .inner-circle .note-segment:nth-child(7) { --rotation-deg: 180deg; }
        .outer-circle .note-segment:nth-child(8), .inner-circle .note-segment:nth-child(8) { --rotation-deg: 210deg; }
        .outer-circle .note-segment:nth-child(9), .inner-circle .note-segment:nth-child(9) { --rotation-deg: 240deg; }
        .outer-circle .note-segment:nth-child(10), .inner-circle .note-segment:nth-child(10) { --rotation-deg: 270deg; }
        .outer-circle .note-segment:nth-child(11), .inner-circle .note-segment:nth-child(11) { --rotation-deg: 300deg; }
        .outer-circle .note-segment:nth-child(12), .inner-circle .note-segment:nth-child(12) { --rotation-deg: 330deg; }

        .note-segment.highlighted {
            background-color: #ffaa00;
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .circle-center {
            position: absolute;
            width: var(--circle-center-size);
            height: var(--circle-center-size);
            background-color: #eee;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            color: #666;
            z-index: 10;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            :root {
                --circle-mobile-size: 95vw;
                --outer-segment-width: 80px;
                --outer-segment-height: 40px;
                --inner-segment-width: 60px;
                --inner-segment-height: 30px;
                --circle-center-size: 80px;
            }

            #circle-of-fifths-container {
                width: var(--circle-mobile-size);
                height: var(--circle-mobile-size);
            }

            .note-segment {
                font-size: 0.8em;
            }

            .outer-circle .note-segment {
                width: var(--outer-segment-width);
                height: var(--outer-segment-height);
                transform-origin: 50% calc(var(--circle-mobile-size) / 2);
                transform: translateY(calc( -1 * (var(--circle-mobile-size) / 2) + (var(--outer-segment-height) / 2) )) rotate(var(--rotation-deg));
            }

            .inner-circle .note-segment {
                width: var(--inner-segment-width);
                height: var(--inner-segment-height);
                transform-origin: 50% calc(var(--circle-mobile-size) * 0.6 / 2);
                transform: translateY(calc( -1 * (var(--circle-mobile-size) * 0.6 / 2) + (var(--inner-segment-height) / 2) )) rotate(var(--rotation-deg));
                font-size: 0.7em;
            }

            .circle-center {
                width: var(--circle-center-size);
                height: var(--circle-center-size);
                font-size: 1.5em;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 0.75rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .loading-spinner { /* No se usará, pero lo dejo por si acaso */
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ffaa00;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">
    <h1 class="text-3xl font-bold mb-8 text-gray-800">Círculo de Quintas Interactivo</h1>

    <div id="circle-of-fifths-container" class="relative flex items-center justify-center bg-white rounded-full shadow-lg">
        <div class="outer-circle">
            <div class="note-segment" data-note="C">C</div>
            <div class="note-segment" data-note="G">G</div>
            <div class="note-segment" data-note="D">D</div>
            <div class="note-segment" data-note="A">A</div>
            <div class="note-segment" data-note="E">E</div>
            <div class="note-segment" data-note="B">B</div>
            <div class="note-segment" data-note="F#">F#</div>
            <div class="note-segment" data-note="Db">Db</div>
            <div class="note-segment" data-note="Ab">Ab</div>
            <div class="note-segment" data-note="Eb">Eb</div>
            <div class="note-segment" data-note="Bb">Bb</div>
            <div class="note-segment" data-note="F">F</div>
        </div>

        <div class="inner-circle">
            <div class="note-segment" data-note="Am">Am</div>
            <div class="note-segment" data-note="Em">Em</div>
            <div class="note-segment" data-note="Bm">Bm</div>
            <div class="note-segment" data-note="F#m">F#m</div>
            <div class="note-segment" data-note="C#m">C#m</div>
            <div class="note-segment" data-note="G#m">G#m</div>
            <div class="note-segment" data-note="Ebm">Ebm</div>
            <div class="note-segment" data-note="Bbm">Bbm</div>
            <div class="note-segment" data-note="Fm">Fm</div>
            <div class="note-segment" data-note="Cm">Cm</div>
            <div class="note-segment" data-note="Gm">Gm</div>
            <div class="note-segment" data-note="Dm">Dm</div>
        </div>

        <div class="circle-center">
            <span class="icon">🔒</span>
        </div>
    </div>

    <div class="flex flex-col sm:flex-row gap-4 mt-8">
        <button id="generateProgressionBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
            Generar Progresión de Acordes
        </button>
        <button id="explainKeyBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
            Explicar Tonalidad
        </button>
        <button id="suggestSubstitutionsBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
            Sugerir Sustituciones de Acordes
        </button>
        <button id="generateSongIdeasBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
            Generar Ideas para Canciones
        </button>
    </div>

    <div id="llmResponseModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modalTitle" class="text-xl font-bold mb-4 text-gray-800"></h2>
            <div id="modalBody" class="text-gray-700">
                <p id="llmResponseText"></p>
            </div>
        </div>
    </div>

    <script>
        // Define las relaciones entre las tonalidades mayores y sus acordes diatónicos (mayores y menores)
        // y la tonalidad menor relativa.
        // Se definen fuera del DOMContentLoaded para asegurar su disponibilidad global en el script.
        const tonalidades = {
            'C': { major: ['C', 'F', 'G'], minor: ['Am', 'Dm', 'Em'] },
            'G': { major: ['G', 'C', 'D'], minor: ['Em', 'Am', 'Bm'] },
            'D': { major: ['D', 'G', 'A'], minor: ['Bm', 'Em', 'F#m'] },
            'A': { major: ['A', 'D', 'E'], minor: ['F#m', 'Bm', 'C#m'] },
            'E': { major: ['E', 'A', 'B'], minor: ['C#m', 'F#m', 'G#m'] },
            'B': { major: ['B', 'E', 'F#'], minor: ['G#m', 'C#m', 'Ebm'] },
            'F#': { major: ['F#', 'B', 'C#'], minor: ['Ebm', 'G#m', 'Bbm'] },
            'Db': { major: ['Db', 'Gb', 'Ab'], minor: ['Bbm', 'Ebm', 'Fm'] },
            'Ab': { major: ['Ab', 'Db', 'Eb'], minor: ['Fm', 'Bbm', 'Cm'] },
            'Eb': { major: ['Eb', 'Ab', 'Bb'], minor: ['Cm', 'Fm', 'Gm'] },
            'Bb': { major: ['Bb', 'Eb', 'F'], minor: ['Gm', 'Cm', 'Dm'] },
            'F': { major: ['F', 'Bb', 'C'], minor: ['Dm', 'Gm', 'Am'] },
        };

        // Define el mapeo de las tonalidades menores a sus tonalidades mayores relativas.
        const relativeMajors = {
            'Am': 'C', 'Em': 'G', 'Bm': 'D', 'F#m': 'A', 'C#m': 'E', 'G#m': 'B',
            'Ebm': 'F#', 'Bbm': 'Db', 'Fm': 'Ab', 'Cm': 'Eb', 'Gm': 'Bb', 'Dm': 'F',
        };

        // --- Datos predefinidos para las respuestas ---
        // Se definen fuera del DOMContentLoaded para asegurar su disponibilidad global en el script.
        const predefinedResponses = {
            "C": {
                "progression": "Una progresión clásica en Do Mayor es **C - G - Am - F** (I - V - vi - IV). Transmite un sentimiento alegre y familiar.",
                "explanation": "La tonalidad de Do Mayor (C) no tiene sostenidos ni bemoles en su armadura de clave. Sus acordes principales son C (Do Mayor), F (Fa Mayor) y G (Sol Mayor). Es una tonalidad brillante y muy común.",
                "substitutions": "Para C mayor: Gsus4 puede sustituir a G. Am7 para C. Cmaj7 para un sonido más suave.",
                "songIdeas": "1. Una balada alegre sobre el primer amor. 2. Una canción infantil con un coro pegadizo. 3. Un himno de gratitud y esperanza."
            },
            "G": {
                "progression": "Una progresión popular en Sol Mayor es **G - D - Em - C** (I - V - vi - IV). Es una progresión muy usada en folk y rock.",
                "explanation": "La tonalidad de Sol Mayor (G) tiene un sostenido (F#) en su armadura de clave. Sus acordes principales son G (Sol Mayor), C (Do Mayor) y D (Re Mayor). Es una tonalidad cálida y versátil.",
                "substitutions": "Para G mayor: Cadd9 puede sustituir a C. Dsus4 a D. Bm7 para Em.",
                "songIdeas": "1. Un tema aventurero sobre un viaje por carretera. 2. Una canción campestre sobre la naturaleza. 3. Un himno optimista de superación."
            },
            "Am": {
                "progression": "Una progresión común en La Menor es **Am - G - C - F** (i - VII - III - VI). Tiene un sentimiento melancólico pero con resolución.",
                "explanation": "La tonalidad de La Menor (Am) es la relativa menor de Do Mayor. No tiene sostenidos ni bemoles. Sus acordes principales son Am (La Menor), Dm (Re Menor) y Em (Mi Menor) o E Mayor (V armónico).",
                "substitutions": "Para Am menor: Dsus2 puede sustituir a Dm. Em7 para Am. Gmaj7 para un sonido más sofisticado.",
                "songIdeas": "1. Una historia de desamor en la noche. 2. Un cuento gótico sobre un viejo misterio. 3. Un lamento por tiempos perdidos."
            },
            // --- Puedes añadir más notas y sus respuestas aquí ---
        };

        document.addEventListener('DOMContentLoaded', () => {
            const noteSegments = document.querySelectorAll('.note-segment');
            const generateProgressionBtn = document.getElementById('generateProgressionBtn');
            const explainKeyBtn = document.getElementById('explainKeyBtn');
            const suggestSubstitutionsBtn = document.getElementById('suggestSubstitutionsBtn');
            const generateSongIdeasBtn = document.getElementById('generateSongIdeasBtn');
            const llmResponseModal = document.getElementById('llmResponseModal');
            const closeButton = document.querySelector('.close-button');
            const modalTitle = document.getElementById('modalTitle');
            const llmResponseText = document.getElementById('llmResponseText');

            let currentSelectedNote = null;

            // Función para obtener y mostrar la respuesta predefinida
            function getPredefinedResponse(note, type) {
                if (predefinedResponses[note] && predefinedResponses[note][type]) {
                    showModal(
                        `${type === 'progression' ? 'Progresión de Acordes' :
                           type === 'explanation' ? 'Explicación de la Tonalidad' :
                           type === 'substitutions' ? 'Sugerencias de Sustituciones' :
                           'Ideas para Canciones'} para ${note}`,
                        predefinedResponses[note][type]
                    );
                } else {
                    showModal("Información no disponible", `No hay información predefinida para ${type} en la tonalidad de ${note}.`);
                }
            }

            // Función para mostrar el modal
            function showModal(title, content) {
                modalTitle.textContent = title;
                llmResponseText.innerHTML = content;
                llmResponseModal.style.display = 'flex';
            }

            // Función para ocultar el modal
            function hideModal() {
                llmResponseModal.style.display = 'none';
                llmResponseText.textContent = '';
                modalTitle.textContent = '';
            }

            closeButton.addEventListener('click', hideModal);
            window.addEventListener('click', (event) => {
                if (event.target == llmResponseModal) {
                    hideModal();
                }
            });

            noteSegments.forEach(segment => {
                segment.addEventListener('click', () => {
                    const selectedNote = segment.dataset.note;
                    currentSelectedNote = selectedNote;

                    noteSegments.forEach(s => s.classList.remove('highlighted'));

                    let notesToHighlight = new Set();
                    if (tonalidades[selectedNote]) {
                        const currentTonalidadData = tonalidades[selectedNote];
                        notesToHighlight.add(selectedNote);
                        currentTonalidadData.major.forEach(note => notesToHighlight.add(note));
                        currentTonalidadData.minor.forEach(note => notesToHighlight.add(note));
                    } else if (relativeMajors[selectedNote]) {
                        const majorKey = relativeMajors[selectedNote];
                        const currentTonalidadData = tonalidades[majorKey];
                        notesToHighlight.add(selectedNote);
                        notesToHighlight.add(majorKey);
                        currentTonalidadData.major.forEach(note => notesToHighlight.add(note));
                        currentTonalidadData.minor.forEach(note => notesToHighlight.add(note));
                    }

                    if (notesToHighlight.size > 0) {
                        notesToHighlight.forEach(noteToFind => {
                            const foundSegment = document.querySelector(`.note-segment[data-note="${noteToFind}"]`);
                            if (foundSegment) {
                                foundSegment.classList.add('highlighted');
                            }
                        });
                    }
                });
            });

            // Modificación de los Event Listeners para usar datos predefinidos
            generateProgressionBtn.addEventListener('click', () => {
                if (currentSelectedNote) {
                    getPredefinedResponse(currentSelectedNote, 'progression');
                } else {
                    showModal("Error", "Por favor, selecciona una nota en el círculo para generar una progresión.");
                }
            });

            explainKeyBtn.addEventListener('click', () => {
                if (currentSelectedNote) {
                    getPredefinedResponse(currentSelectedNote, 'explanation');
                } else {
                    showModal("Error", "Por favor, selecciona una nota en el círculo para obtener una explicación.");
                }
            });

            suggestSubstitutionsBtn.addEventListener('click', () => {
                if (currentSelectedNote) {
                    getPredefinedResponse(currentSelectedNote, 'substitutions');
                } else {
                    showModal("Error", "Por favor, selecciona una nota en el círculo para obtener sugerencias de sustituciones.");
                }
            });

            generateSongIdeasBtn.addEventListener('click', () => {
                if (currentSelectedNote) {
                    getPredefinedResponse(currentSelectedNote, 'songIdeas');
                } else {
                    showModal("Error", "Por favor, selecciona una nota en el círculo para generar ideas para canciones.");
                }
            });
        });
    </script>
</body>
</html>
